var c=null,i=!1;function j(f){return f.options==c&&"boolean"!=typeof f?f.split(","):f.options}var p={},v=[32,59,186,188,190]; tinymce.create("tinymce.plugins.AutoCompletePlugin",{Y:function(f){p.options=j(f)},L:function(){return p.options},P:function(f){function s(b,a){var d=matches,e="",f=RegExp("("+b+")"),g;for(g in d)e=d[g].key!=c?e+("<li data-value='"+d[g].key+"'>"+d[g].key.replace(f,"<mark>$1</mark>")+" "+d[g].description+"</li>"):e+("<li data-value='"+d[g]+"'>"+d[g].replace(f,"<mark>$1</mark>")+"</li>");jQuery(p.list).N(e);var d=jQuery(a.t()).position(),e=jQuery(a.t()).find(".mceToolbar").J(),f=jQuery(a.selection.u()).position(), k=g=0;0<a.selection.h().getClientRects().length?(g=a.selection.h().getClientRects()[0].top+a.selection.h().getClientRects()[0].height,k=a.selection.h().getClientRects()[0].left):(g=1.3*parseInt(jQuery(a.selection.u()).f("font-size"))+f.top,k=f.left);jQuery(p.list).f("margin-top",d.top+e.innerHeight()+g);jQuery(p.list).f("margin-left",d.left+k);jQuery(p.list).f("display","block");p.visible=!0;jQuery(p.list).find("li").M(function(){jQuery(p.list).find("[data-selected=true]").a("data-selected","false"); jQuery(this).a("data-selected","true")});jQuery(p.list).find("li").click(function(){t(a,m(a))})}function l(){jQuery(p.list).f("display","none");p.visible=i}function q(){var b=jQuery(p.list).find("[data-selected=true]");0==b.size()||0==b.next().size()?jQuery(p.list).find("li:first-child").a("data-selected","true"):b.next().a("data-selected","true");b.a("data-selected","false")}function t(b,a){var d=jQuery(p.list).find("[data-selected=true]").a("data-value");d==c&&(d=jQuery(p.list).find("li:first-child").a("data-value")); var e=u(b.selection.i().anchorNode,""),f=b.selection.i().anchorNode.textContent,g=b.selection.h();g.setStart(g.startContainer,g.startOffset-a.length);b.selection.Z(g);g="";0<p.m.length&&(g=String.fromCharCode(p.m[0]));b.selection.z(p.c+d.toString()+g);var k;if(k=0<p.g.length)k=p.c+p.g,e=e.substr(f.length),e=RegExp(p.c+".{"+p.g.length+"}","g").exec(e),k=!(e!=c&&0<e.length&&e[0]==k);k&&(e=b.selection.getBookmark(),b.selection.z(g+p.c+p.g),b.selection.moveToBookmark(e));l();p.e&&h.e.r(b,d);l()}function u(b, a){a+=b.textContent;return b.nextSibling!=c?u(b.nextSibling,a):a}function n(b){var a=p.options,d=[],e;for(e in a)a[e].key==c&&(0==b.length||a[e].match(RegExp("^"+b,"i")))?d.push(a[e]):a[e].key!=c&&(0==b.length||a[e].key.match(RegExp("^"+b,"i")))&&d.push(a[e]);return d}function m(b){var a=b.selection.i().focusNode==c?"":b.selection.i().focusNode.nodeValue,b=b.selection.i().focusOffset;if(a==c||0==a.length)return"";for(var d=0,e=0;e<b;e++)-1!=p.m.indexOf(a.charCodeAt(e).toString())&&(d=e+1);a=a.substr(d, b-d);b="";""==p.c?a.length>=p.v&&(b=a):0<a.length&&a.charAt(0).toString()==p.c&&(b=a);return b}var r=document.createElement("ul");jQuery(r).D("auto-list");document.body.appendChild(r);p={list:r,visible:i,l:i,m:f.b("autocomplete_delimiters","160,32").split(","),options:j(f.b("autocomplete_options","")),p:j(f.b("autocomplete_options_url",i)),c:f.b("autocomplete_trigger","@"),g:f.b("autocomplete_end_option",""),v:f.b("autocomplete_min_length","3"),e:f.b("autocomplete_on_select",i),d:f.b("autocomplete_on_match", i)};var h=this;p.e&&(h.e=new tinymce.A.q(h),h.e.add(function(b,a){b.s("autocomplete_on_select",b,a)}));p.d&&(h.d=new tinymce.A.q(h),h.d.add(function(b,a){b.s("autocomplete_on_match",b,a)}));f.X.o(function(b,a){if(!p.visible&&27!=a.keyCode&&13!=a.keyCode||40!=a.keyCode&&38!=a.keyCode&&13!=a.keyCode&&27!=a.keyCode){var d=m(b),e=n(d);if(0<d.length){var h=d.replace(p.c,"");p.p?1>=h.length||jQuery.F({type:"GET",url:p.p,I:i,data:"q="+h,$:function(a){if(a.T&&a.j){var b=[],d;for(d in a.j)a.j[d].name&&b.push(a.j[d].name); p.options=b;matches=n(h);0<matches.length&&(s(h,f),q())}},error:function(){}}):(matches=n(h),0<matches.length&&(s(h,f),q()))}(0==d.length||0==e.length)&&l()}});f.V.o(function(b,a){if(p.visible){if(40==a.keyCode)return q(),tinymce.n.k.cancel(a);if(38==a.keyCode){var d=jQuery(p.list).find("[data-selected=true]");0==d.size()||0==d.w().size()?jQuery(p.list).find("li:last-child").a("data-selected","true"):d.w().a("data-selected","true");d.a("data-selected","false");return tinymce.n.k.cancel(a)}if(13== a.keyCode)return t(b,m(b)),p.l=!0,i;if(27==a.keyCode)return l(),tinymce.n.k.cancel(a);if(p.d&&v.indexOf(a.keyCode)){var d=m(b),e=n(d),f=RegExp("^"+e[0]+"$","i");1==e.length&&d.match(f)&&h.d.r(b,e[0])}}});f.W.o(function(b,a){if(13==a.keyCode&&p.l)return p.l=i,tinymce.n.k.cancel(a)});f.U.add(function(){l()})},K:function(){return{Q:"AutoComplete",G:"Mijura Pty Ltd",H:"http://mijura.com",O:"http://blog.mijura.com",version:tinymce.R+"."+tinymce.S}}});tinymce.C.add("autocomplete",tinymce.plugins.B);