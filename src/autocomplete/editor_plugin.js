(function(){var e={};var d=40;var f=38;var a=27;var c=13;function b(g){return g.options==null?g.split(","):g.options;}tinymce.create("tinymce.plugins.AutoCompletePlugin",{setOptions:function(g){e.options=b(g);},getOptions:function(){return e.options;},init:function(l,k){e={list:o(),visible:false,cancelEnter:false,delimiter:l.getParam("autocomplete_delimiters","160,32").split(","),options:b(l.getParam("autocomplete_options","")),trigger:l.getParam("autocomplete_trigger","@"),enclosing:l.getParam("autocomplete_end_option","")};function n(y,B){if((!e.visible&&B.keyCode!=a&&B.keyCode!=c)||(B.keyCode!=d&&B.keyCode!=f&&B.keyCode!=c&&B.keyCode!=a)){var z=x(y);var A=[];if(z.length>0){var C=z.replace(e.trigger,"");A=j(C);if(A.length>0){q(A,C,y);r();}}if(z.length==0||A.length==0){w();}}}function s(y,z){if(z.keyCode==c&&e.cancelEnter){e.cancelEnter=false;return tinymce.dom.Event.cancel(z);}}function m(y,z){if(e.visible){if(z.keyCode==d){r();return tinymce.dom.Event.cancel(z);}if(z.keyCode==f){h();return tinymce.dom.Event.cancel(z);}if(z.keyCode==c){v(y,x(y));e.cancelEnter=true;return;}if(z.keyCode==a){w();return tinymce.dom.Event.cancel(z);}}}function i(y,z){w();}function q(E,H,G){var A="";var B=new RegExp("("+H+")");for(var D in E){if(E[D].key!=null){A+="<li data-value='"+E[D].key+"'>"+E[D].key.replace(B,"<mark>$1</mark>")+" "+E[D].description+"</li>";}else{A+="<li data-value='"+E[D]+"'>"+E[D].replace(B,"<mark>$1</mark>")+"</li>";}}jQuery(e.list).html(A);var y=jQuery(G.getContainer()).position();var I=jQuery(G.getContainer()).find(".mceToolbar").first();var z=jQuery(G.selection.getNode()).position();var F=0;var C=0;if(G.selection.getRng().getClientRects().length>0){F=G.selection.getRng().getClientRects()[0].top+G.selection.getRng().getClientRects()[0].height;C=G.selection.getRng().getClientRects()[0].left;}else{F=parseInt(jQuery(G.selection.getNode()).css("font-size"))*1.3+z.top;C=z.left;}jQuery(e.list).css("margin-top",y.top+I.innerHeight()+F);jQuery(e.list).css("margin-left",y.left+C);jQuery(e.list).css("display","block");e.visible=true;u(G);}function u(y){jQuery(e.list).find("li").hover(function(){jQuery(e.list).find("[data-selected=true]").attr("data-selected","false");jQuery(this).attr("data-selected","true");});jQuery(e.list).find("li").click(function(){v(y,x(y));});}function o(){var y=document.createElement("ul");jQuery(y).addClass("auto-list");document.body.appendChild(y);return y;}function w(){jQuery(e.list).css("display","none");e.visible=false;}function r(){var y=jQuery(e.list).find("[data-selected=true]");if(y.size()==0||y.next().size()==0){jQuery(e.list).find("li:first-child").attr("data-selected","true");}else{y.next().attr("data-selected","true");}y.attr("data-selected","false");}function h(){var y=jQuery(e.list).find("[data-selected=true]");if(y.size()==0||y.prev().size()==0){jQuery(e.list).find("li:last-child").attr("data-selected","true");}else{y.prev().attr("data-selected","true");}y.attr("data-selected","false");}function v(z,A){var E=jQuery(e.list).find("[data-selected=true]").attr("data-value");if(E==null){E=jQuery(e.list).find("li:first-child").attr("data-value");}var C=t(z.selection.getSel().anchorNode,"");var B=z.selection.getSel().anchorNode.textContent;var y=z.selection.getRng();y.setStart(y.startContainer,y.startOffset-A.length);z.selection.setRng(y);var F="";if(e.delimiter.length>0){F=String.fromCharCode(e.delimiter[0]);}z.selection.setContent(e.trigger+E+F);if(e.enclosing.length>0&&!g(C,B)){var D=z.selection.getBookmark();z.selection.setContent(F+e.trigger+e.enclosing);z.selection.moveToBookmark(D);}w();}function g(z,y){var B=e.trigger+e.enclosing;z=z.substr(y.length);var A=new RegExp(e.trigger+".{"+e.enclosing.length+"}","g").exec(z);if(A!=null&&A.length>0&&A[0]==B){return true;}return false;}function t(y,z){z+=y.textContent;if(y.nextSibling!=null){return t(y.nextSibling,z);}return z;}function j(A){var y=e.options;var B=[];for(var z in y){if(y[z].key==null&&(A.length==0||p(A,y[z]))){B.push(y[z]);}else{if(y[z].key!=null&&(A.length==0||p(A,y[z].key))){B.push(y[z]);}}}return B;}function p(z,y){return(y.match("^"+z)==z);}function x(z){var C=z.selection.getSel().focusNode==null?"":z.selection.getSel().focusNode.nodeValue;var A=z.selection.getSel().focusOffset;if(C==null||C.length==0){return"";}var y=0;for(var B=0;B<A;B++){if(e.delimiter.indexOf(C.charCodeAt(B).toString())!=-1){y=B+1;}}var D=C.substr(y,A-y);if(D.length>0&&D.charAt(0).toString()==e.trigger){return D;}return"";}l.onKeyUp.addToTop(n);l.onKeyDown.addToTop(m);l.onKeyPress.addToTop(s);l.onClick.add(i);},getInfo:function(){return{longname:"AutoComplete",author:"Mijura Pty Ltd",authorurl:"http://mijura.com",infourl:"http://blog.mijura.com",version:tinymce.majorVersion+"."+tinymce.minorVersion};}});tinymce.PluginManager.add("autocomplete",tinymce.plugins.AutoCompletePlugin);})();